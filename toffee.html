<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bostafull Player | Buddyâœ˜TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Clappr Player Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/level-selector@0.2.0/dist/level-selector.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@clappr/hlsjs-playback@1.0.1/dist/hlsjs-playback.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
  }

  #player {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  /* When screen width is below 400px, scale down entire page */
  @media (max-width: 400px) {
    body {
      transform: scale(0.8);
      transform-origin: top left;
      width: 125%;   /* compensate for scaling shrink */
      height: 125%;
    }
  }
</style>
</head>
<body>
  <div id="player"></div>

<script>
  // Disable right-click
  document.addEventListener("contextmenu", e => e.preventDefault());

  // Get query parameter
  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // Create Clappr player
  function createPlayer(sourceUrl) {
    const player = new Clappr.Player({
      source: sourceUrl,
      parentId: "#player",
      width: "100%",
      height: "100%",
      autoPlay: true,
      mute: false,
      mimeType: "application/x-mpegURL",
      plugins: [HlsjsPlayback, LevelSelector],
      mediacontrol: { seekbar: "#ff0000", buttons: "#eee" }
    });

    // Auto-retry on errors
    player.on(Clappr.Events.PLAYER_ERROR, () => {
      setTimeout(() => {
        player.load(player.options.source);
        player.play();
      }, 1500);
    });

    // Prevent accidental stops
    player.on(Clappr.Events.PLAYER_STOP, () => {
      player.play();
    });
  }

  const requestedTitle = getQueryParam('id');

  if (!requestedTitle) {
    document.body.innerHTML = "<h2 style='color:white;text-align:center;margin-top:20%'>No Channel Selected</h2>";
  } else {

    // ðŸ”´ CHANGE THIS to the external HTML page you want to read
    const SOURCE_HTML_URL = "https://example.com/page.html";

    fetch(SOURCE_HTML_URL)
      .then(res => res.text())
      .then(html => {

        // Parse HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        // Find the script containing "allChannels"
        const scripts = [...doc.querySelectorAll('script')];
        const targetScript = scripts.find(s => s.textContent.includes('allChannels'));

        if (!targetScript) throw new Error('Channel script not found');

        // Extract JS array from script
        const jsText = targetScript.textContent;
        const match = jsText.match(/const allChannels\s*=\s*(\[[\s\S]*?\]);/);

        if (!match) throw new Error('allChannels array not found');

        // Convert JS text array into real object
        const channels = eval(match[1]);

        // Find requested channel
        const found = channels.find(c =>
          c.name.toLowerCase().includes(requestedTitle.toLowerCase()) ||
          c.id.toLowerCase() === requestedTitle.toLowerCase()
        );

        if (!found) {
          document.body.innerHTML = `<h2 style="color:white;text-align:center;margin-top:20%">Channel "${requestedTitle}" not found</h2>`;
          return;
        }

        // Build your m3u8 URL from ID
        const streamUrl = `https://livecdn-bostaflix.global.ssl.fastly.net/stream.php/${found.id}.m3u8`;

        createPlayer(streamUrl);
      })
      .catch(err => {
        console.error(err);
        document.body.innerHTML = `<h2 style="color:white;text-align:center;margin-top:20%">Failed to load channel source</h2>`;
      });
  }
</script>

</body>
</html>
