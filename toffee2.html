<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Channel Player</title>
  <style>
    html, body {
      margin:0;
      padding:0;
      width:100vw;
      height:100vh;
      overflow:hidden;
    }
    iframe {
      position: fixed;
      top:0;
      left:0;
      width:100vw;
      height:100vh;
      border:0;
    }
    .message {
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      color:#fff;
      background:#000;
      font-size:1.5rem;
      text-align:center;
    }
  </style>
</head>
<body>

<iframe id="player" src=""></iframe>
<div id="msg" class="message" style="display:none;"></div>

<script>
  async function init() {
    const params = new URLSearchParams(window.location.search);
    const queryTitle = params.get('id');
    if (!queryTitle) {
      showMessage('No channel title specified in query parameters.');
      return;
    }

    try {
      const resp = await fetch('https://xfireflix.fun/test/kaya_app.php?route=getChannels');
      if (!resp.ok) {
        showMessage('Failed to fetch channel list. Status: ' + resp.status);
        return;
      }
      const json = await resp.json();
      const list = (json.data && json.data.list) ? json.data.list : [];

      const channel = list.find(c => c.title && c.title.toLowerCase() === queryTitle.toLowerCase());
      if (channel && channel.id) {
        document.getElementById('player').src = `https://xfireflix.fun/test/player.php?id=${channel.id}`;
      } else {
        showMessage('Channel not found: ' + queryTitle);
      }
    } catch (err) {
      console.error(err);
      showMessage('An error occurred loading channel list.');
    }
  }

  function showMessage(msg) {
    const banner = document.getElementById('msg');
    banner.textContent = msg;
    banner.style.display = 'flex';
    document.getElementById('player').style.display = 'none';
  }

  // run
  init();
</script>

</body>
</html>
