<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOSTAFLIX - Smart Ramadan TV</title>
<link href="https://banglawebfonts.pages.dev/css/siyam-rupali.css" rel="stylesheet">

<style>
body {
    margin: 0;
    font-family: 'Siyam Rupali', sans-serif;
    background: #000;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
}
.ramadan-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    border: none;
    z-index: 1;
}
.ui-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 10;
    display: flex;
    flex-direction: column;
    pointer-events: none;
}
.topbar {
    width: 100vw;
    height: 9vh;
    background: #ff2d2d;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 4vh;
    white-space: nowrap;
    pointer-events: auto;
}
.topbar span { margin: 0 1.5vw; }
.bottom-container { margin-top: auto; pointer-events: auto; }
.bottombar {
    width: 100vw;
    height: 9vh;
    background: #0b57d0;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4vh;
    font-weight: 600;
}
.scrollbar {
    width: 100vw;
    height: 9vh;
    background: #000;
    color: #ffd700;
    display: flex;
    align-items: center;
    overflow: hidden;
    font-size: 4vh;
    border-top: 1px solid #333;
}
.scroll-text {
    white-space: nowrap;
    display: inline-block;
    padding-left: 100%;
    animation: scroll-left linear infinite;
}
@keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
}
</style>
</head>

<body>

<iframe src="data.html" class="ramadan-bg"></iframe>

<div class="ui-overlay">
    <div class="topbar">
        <span style="font-weight:900;">BOSTAFLIX</span>
        <span>|</span>
        <span id="engDate"></span>
        <span>|</span>
        <span id="hijriDate"></span>
        <span>|</span>
        <span id="liveTime"></span>
    </div>

    <div class="bottom-container">
        <div class="bottombar" id="countdownText">লোড হচ্ছে...</div>
        <div class="scrollbar">
            <div class="scroll-text" id="divisionalScroll">তথ্যাদি লোড হচ্ছে...</div>
        </div>
    </div>
</div>

<script>
const config = {
    city: 'Dhaka',
    country: 'Bangladesh',
    method: 1,
    school: 1,
    adjustment: -1 // ← change to 0 if API matches BD exactly
};

const hijriMonths = ["মুহাররম","সফর","রবিউল আউয়াল","রবিউস সানি","জুমাদাল উলা","জুমাদাস সানি","রজব","শা‘বান","রমযান","শাওয়াল","যিলকদ","যিলহজ"];

const prayerLabels = {
    Fajr: "সেহরির শেষ সময়/ফজর",
    Dhuhr: "যোহর",
    Asr: "আসর",
    Maghrib: "মাগরিব/ইফতার",
    Isha: "এশা"
};

let apiTimings = null;
let hijriData = null;

function toBanglaNumber(num){
    return num.toString().replace(/\d/g, d => '০১২৩৪৫৬৭৮৯'[d]);
}

function addMinutes(timeStr, mins) {
    let [hh, mm] = timeStr.split(':').map(Number);
    let d = new Date();
    d.setHours(hh, mm + mins, 0);
    return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
}

async function fetchAllData() {
    try {
        const today = new Date();
        const dateStr = `${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}`;

        const response = await fetch(
            `https://api.aladhan.com/v1/timingsByCity?city=${config.city}&country=${config.country}&method=${config.method}&school=${config.school}&date=${dateStr}&adjustment=${config.adjustment}`
        );

        const result = await response.json();

        if(result.code === 200){
            const t = result.data.timings;

            apiTimings = {
                Fajr: t.Fajr,
                Dhuhr: t.Dhuhr,
                Asr: t.Asr,
                Maghrib: t.Maghrib,
                Isha: t.Isha
            };

            hijriData = result.data.date.hijri;
        }

    } catch(e){
        console.error("API Error");
    }
}

function updateUI() {
    const now = new Date();

    document.getElementById('engDate').innerText =
        now.toLocaleDateString('bn-BD', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

    document.getElementById('liveTime').innerText =
        toBanglaNumber(now.toLocaleTimeString('en-US',{ hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true }));

    if(hijriData){
        document.getElementById('hijriDate').innerText =
            `${toBanglaNumber(hijriData.day)} ${hijriMonths[hijriData.month.number-1]}, ${toBanglaNumber(hijriData.year)}`;
    }

    if (!apiTimings) return;

    const prayers = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];
    let nextP = null, targetT = null;

    for (let p of prayers) {
        let pt = new Date();
        pt.setHours(...apiTimings[p].split(':'), 0);
        if (now < pt) { nextP = p; targetT = pt; break; }
    }

    if (!nextP) {
        nextP = "Fajr";
        targetT = new Date(now.getTime() + 86400000);
        targetT.setHours(...apiTimings["Fajr"].split(':'), 0);
    }

    const diff = targetT - now;
    const h = Math.floor(diff/3600000),
          m = Math.floor((diff%3600000)/60000),
          s = Math.floor((diff%60000)/1000);

    document.getElementById('countdownText').innerText =
        `ঢাকার ${prayerLabels[nextP]} শুরু হতে আর ${toBanglaNumber(h)} ঘণ্টা ${toBanglaNumber(m)} মিনিট ${toBanglaNumber(s)} সেকেন্ড বাকি`;
}

async function init(){
    await fetchAllData();
    updateUI();
    setInterval(updateUI, 1000);
    setInterval(fetchAllData, 3600000);
}

init();
</script>

</body>
</html>
