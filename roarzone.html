<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadoo | Buddy✘TV</title>

<script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@clappr/hlsjs-playback@1.0.1/dist/hlsjs-playback.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
}
#player {
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>

<div id="player"></div>

<script>
const M3U_URL =
  "https://raw.githubusercontent.com/mahabubur016823/roarzone.m3u/refs/heads/main/playlist.m3u";

function getQueryParam(name) {
  return new URLSearchParams(window.location.search).get(name);
}

// --- Parse M3U ---
function parseM3U(text) {
  const lines = text.split("\n");
  const channels = [];

  for (let i = 0; i < lines.length; i++) {
    if (lines[i].startsWith("#EXTINF")) {
      const info = lines[i];
      const url = lines[i + 1]?.trim();
      if (!url) continue;

      const tvgId = (info.match(/tvg-id="([^"]+)"/i) || [])[1];
      const name = info.split(",").pop().trim();

      channels.push({
        tvgId: tvgId?.toLowerCase(),
        name: name.toLowerCase(),
        url
      });
    }
  }
  return channels;
}

// --- Create Player ---
function createPlayer(sourceUrl) {
  new Clappr.Player({
    parentId: "#player",
    source: sourceUrl,
    autoPlay: true,
    width: "100%",
    height: "100%",
    mimeType: "application/x-mpegURL",
    playback: {
      hlsjsConfig: {
        xhrSetup: function (xhr) {
          xhr.withCredentials = true; // ✅ credentials enabled
        }
      }
    },
    plugins: [HlsjsPlayback]
  });
}

// --- Main ---
const channelId = getQueryParam("id")?.toLowerCase();

if (!channelId) {
  console.error("No ?id provided");
} else {
  fetch(M3U_URL)
    .then(r => r.text())
    .then(text => {
      const channels = parseM3U(text);
      const channel = channels.find(
        c => c.tvgId === channelId || c.name === channelId
      );

      if (!channel) {
        console.error("Channel not found:", channelId);
        return;
      }

      createPlayer(channel.url);
    })
    .catch(err => console.error("M3U load error:", err));
}
</script>

</body>
</html>
